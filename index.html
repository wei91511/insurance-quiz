<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>保險十問 | 赴醫路上的生命體悟</title>
    <!-- 載入必要套件 CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 修正：使用 lucide-react 的 UMD 版本 -->
    <script src="https://unpkg.com/lucide-react"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&family=Noto+Serif+TC:wght@700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #FDFBF7; scroll-behavior: smooth; }
        .font-story { font-family: 'Noto Serif TC', serif; }
        .paper-texture { background-image: url('https://www.transparenttextures.com/patterns/natural-paper.png'); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .fade-in { animation: fadeIn 0.8s forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .image-sketch { filter: grayscale(1) contrast(1.2) brightness(1.05) sepia(0.1); }
        .btn-active:active { transform: scale(0.98); }
    </style>
</head>
<body class="paper-texture">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        // 從 LucideReact 全域變數中取得組件
        const { 
            ArrowLeft, 
            ChevronRight, 
            Send, 
            CheckCircle, 
            Loader2, 
            Shield, 
            User, 
            Phone, 
            MessageSquare, 
            Heart, 
            Image: ImageIcon 
        } = LucideReact;

        // ==========================================
        // 1. 重要設定區 (實作時請填入您的 API 資訊)
        // ==========================================
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxcgIEXP7tOjiVqWbB4yjwFebYOeXKRKNsg7Rdv0K9CC9qTmxassSWo2h7FRz7TGpFgFg/exec"; // 貼上您的 Google Apps Script 網頁應用程式網址
        const GEMINI_API_KEY = "AIzaSyDlmJvI7v0oK1NHuR35sSawfHT7F-TeGkI";    // 貼上您的 Gemini API Key.

        // ==========================================
        // 2. 題目資料
        // ==========================================
        const scenarioData = [
            {
                id: 'q1',
                title: "意外與責任",
                scenario: "正準備穿過馬路，卻看見路口發生嚴重車禍，一人倒在車前。你不禁想，如果那是你，你留下的愛是否足夠支撐家人接下來五到十年的生活？",
                query: "目前的保險規劃，是否有「1,000 萬」以上的身故/失能保障？",
                imagePrompt: "A high-quality realistic pencil sketch, POV perspective. Standing at a crosswalk, seeing a car accident in the middle of the road. People are nervous. Deep shadows, fine graphite texture.",
                options: ["非常有信心，已規劃 1,000 萬以上", "有規劃，但額度低於 1,000 萬", "目前完全沒有意外險規劃"]
            },
            {
                id: 'q2',
                title: "骨折與休養",
                scenario: "看著前方傷者嚴重骨折，你低下頭看著自己的腿。若這發生在正要工作的你，接下來三個月不能賺錢，風險該如何轉嫁？",
                query: "你的保障能否在不必住院的情況下，補貼「每日 3,000 元」的薪資損失？",
                imagePrompt: "A realistic pencil sketch, POV perspective. Looking down at one's own leg in a plaster cast. Detailed graphite art.",
                options: ["沒問題，每日補貼超過 3,000 元", "有部分補貼，但不足 3,000 元", "目前沒有規劃骨折未住院補貼"]
            },
            {
                id: 'q3',
                title: "醫療品質的權利",
                scenario: "在醫院等候時，聽見隔壁討論自費微創手術。你想起如果今天要動刀的是你，你是否擁有不看存摺、直接選最好技術的權利？",
                query: "目前的實支實付額度，是否足以支付「20 萬」以上的自費雜費？",
                imagePrompt: "A realistic pencil sketch, POV perspective. Inside a consultation room, doctor points to a monitor showing a surgery simulation.",
                options: ["足夠，自費雜費額度超過 20 萬", "有實支實付，但額度不足 20 萬", "目前僅有定額給付，無自費雜費保障"]
            },
            {
                id: 'q4',
                title: "住院後的隱形成本",
                scenario: "路過病房區，看到家屬拎著大包小包營養品與看護。住院不只是收據上的開銷，往返車資與隱藏開支才是最磨人的心累。",
                query: "除了醫療單據，你是否有一筆「每日 3,000 元」的定額補償來支付這些雜支？",
                imagePrompt: "A realistic pencil sketch, POV perspective. Hospital hallway, family members carrying heavy bags of supplies.",
                options: ["有，每日定額給付超過 3,000 元", "有，但每日補貼低於 3,000 元", "目前沒有這類住院定額保障"]
            },
            {
                id: 'q5',
                title: "長期的尊嚴",
                scenario: "誤入了長照護理區，一位老人坐臥在床上無助地望向窗外。你想起若有一天自己失去自理能力，你希望如何被對待？",
                query: "當風險發生，你是否有信心每月領取「8 萬」以上的扶助金來支付專業看護？",
                imagePrompt: "A realistic pencil sketch, POV perspective. Looking into a patient room, an elderly person looking out the window at sunlight. Emotional.",
                options: ["非常有信心，每月額度超過 8 萬", "有規劃長照/失能，但每月不到 8 萬", "目前完全沒有長照/失能相關規劃"]
            },
            {
                id: 'q6',
                title: "抗癌的底氣",
                scenario: "看著門診外的標靶藥物 DM，動輒百萬且多在門診支付。你想著如果診斷書突然開下來，你是否有足夠的銀彈迎戰？",
                imagePrompt: "A realistic pencil sketch, POV perspective. Holding a medical brochure about cancer targeted therapy.",
                query: "若不幸確診癌症，你戶頭是否能立刻領到「200 萬」的一次給付金？",
                options: ["已規劃，確診即領 200 萬以上", "有規劃，但一次金不到 200 萬", "目前僅有傳統型癌症險或沒規劃"]
            },
            {
                id: 'q7',
                title: "重大疾病的衝擊",
                scenario: "排隊領藥時看見長輩拿著重大傷病卡。你想起這病不一定奪命，但復健路長，你需要穩定持續的收入支撐生活。",
                query: "如果同樣情況發生，你有把握每個月擁有「5 萬」來支撐生活兩年嗎？",
                imagePrompt: "A realistic pencil sketch, POV perspective. Standing at a pharmacy window holding a health card.",
                options: ["有信心，保障足夠支付 5 萬/月", "有規劃，但無法支撐到 5 萬/月", "目前完全沒有重大傷病相關規劃"]
            },
            {
                id: 'q8',
                title: "遺留的愛",
                scenario: "看著熟睡中的孩子。那一刻你明白，你的生命已不再只屬於你自己。如果明天就是終點，你留下的資源是否足夠讓他們無憂長大？",
                query: "你的壽險規劃，是否足以償還剩餘房貸並留下「500 萬」教育預算？",
                imagePrompt: "A realistic pencil sketch, POV perspective. Looking down at a sleeping baby in a cradle, soft light.",
                options: ["足夠，愛已完整託付 (500 萬以上)", "有規劃，但可能不夠償還房貸或教育", "目前尚未有壽險規劃"]
            },
            {
                id: 'q9',
                title: "財富的守護",
                scenario: "路過銀行，看見巨大的股市走勢海報。紅綠線條有起有落、劇烈波動。你想起辛苦存下的積蓄不該被一場大病侵蝕。",
                query: "你是否偏好透過「保本且穩定」的配置，讓保障與資產在波動市場中同時增長？",
                imagePrompt: "A realistic pencil sketch, POV perspective. Bank window poster with stock market chart and shield icon.",
                options: ["感興趣，希望保障與增值兼具", "不需要增值，我只要純保障", "目前已有其他理財工具"]
            },
            {
                id: 'q10',
                title: "推開家門的瞬間",
                scenario: "手握家門把手，推開門，家人的問候讓你明白，今天這一路上的體悟全是為了守護這個溫暖的出口。",
                query: "你願意讓專業顧問協助你，將這些擔憂轉化為一份確定的防線嗎？",
                imagePrompt: "A realistic pencil sketch, POV perspective. Hand turning a door handle to reveal a warm living room light.",
                options: ["我願意，請安排顧問聯繫我", "想先看詳細分析報告再決定"]
            }
        ];

        function App() {
            const [step, setStep] = useState(0);
            const [answers, setAnswers] = useState([]);
            const [isFinished, setIsFinished] = useState(false);
            const [imgCache, setImgCache] = useState({});
            const [imgLoading, setImgLoading] = useState(false);
            const [lead, setLead] = useState({ name: '', phone: '', line: '' });
            const [isSubmitting, setIsSubmitting] = useState(false);
            const [isSuccess, setIsSuccess] = useState(false);

            useEffect(() => {
                if (!isFinished && !imgCache[step]) {
                    generateImage(scenarioData[step].imagePrompt, step);
                }
            }, [step, isFinished]);

            const generateImage = async (prompt, idx) => {
                if (!GEMINI_API_KEY) return;
                setImgLoading(true);
                try {
                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${GEMINI_API_KEY}`, {
                        method: 'POST',
                        body: JSON.stringify({ instances: [{ prompt }], parameters: { sampleCount: 1 } })
                    });
                    const result = await res.json();
                    if (result.predictions && result.predictions[0]) {
                        setImgCache(prev => ({
                            ...prev,
                            [idx]: `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`
                        }));
                    }
                } catch (e) { console.error("Img Error", e); }
                finally { setImgLoading(false); }
            };

            const handleSelect = (idx) => {
                const newAns = [...answers];
                newAns[step] = { q: scenarioData[step].title, a: scenarioData[step].options[idx], score: idx };
                setAnswers(newAns);
                if (step < 9) setStep(step + 1); else {
                    setIsFinished(true);
                    window.scrollTo(0, 0);
                }
            };

            const submitLead = async () => {
                if (!lead.name || !lead.phone) return;
                setIsSubmitting(true);
                try {
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: "POST",
                        mode: "no-cors",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            name: lead.name,
                            phone: lead.phone,
                            line: lead.line,
                            answers: answers.map(a => `${a.q}: ${a.a}`).join(' | ')
                        })
                    });
                    setIsSuccess(true);
                } catch (e) { alert("提交失敗"); }
                finally { setIsSubmitting(false); }
            };

            if (isFinished) {
                return (
                    <div className="min-h-screen bg-[#FDFBF7] py-20 px-6 max-w-2xl mx-auto paper-texture overflow-y-auto">
                        <div className="text-center mb-32 fade-in">
                            <Shield className="w-16 h-16 mx-auto text-[#C5A059] mb-6" />
                            <h1 className="text-4xl font-black mb-4">生命旅程診斷書</h1>
                            <p className="text-gray-400 italic">守護，是給家人最確定的禮物</p>
                        </div>
                        <div className="space-y-48 mb-60">
                            {answers.map((ans, i) => (
                                <div key={i} className="text-center fade-in">
                                    <span className="text-[10px] font-bold text-[#C5A059] tracking-widest block mb-4 uppercase">POINT {i+1}</span>
                                    <h3 className="text-3xl font-bold mb-4">{ans.q}</h3>
                                    <p className="text-gray-400 text-sm mb-12 italic">您的現狀：{ans.a}</p>
                                    <div className="max-w-xl mx-auto text-xl leading-relaxed text-[#2D3436] font-light">
                                        {ans.score === 0 ? <span className="text-green-700">配置優良！您已建立堅實防線。</span> : ans.score === 1 ? <span className="text-[#C5A059]">意識正確，但額度稍顯單薄，建議微調。</span> : <span className="text-red-600">這是必須正視的缺口，建議優先諮詢補強。</span>}
                                    </div>
                                </div>
                            ))}
                        </div>
                        {!isSuccess ? (
                            <div className="bg-white p-10 sm:p-20 rounded-[60px] shadow-2xl border mb-20 fade-in">
                                <h2 className="text-3xl font-bold mb-8 text-center">預約專業精算分析</h2>
                                <div className="space-y-10 mb-12">
                                    <input className="w-full py-4 text-2xl border-b-2 outline-none focus:border-[#C5A059] bg-transparent" placeholder="如何稱呼您" onChange={e => setLead({...lead, name: e.target.value})} />
                                    <input className="w-full py-4 text-2xl border-b-2 outline-none focus:border-[#C5A059] bg-transparent" placeholder="聯絡手機" onChange={e => setLead({...lead, phone: e.target.value})} />
                                    <input className="w-full py-4 text-2xl border-b-2 outline-none focus:border-[#C5A059] bg-transparent" placeholder="LINE ID (選填)" onChange={e => setLead({...lead, line: e.target.value})} />
                                </div>
                                <button onClick={submitLead} disabled={isSubmitting} className="w-full py-6 bg-[#C5A059] text-white rounded-3xl font-bold text-2xl active:scale-95 transition-all shadow-xl disabled:opacity-30 flex items-center justify-center gap-3">
                                    {isSubmitting ? <Loader2 className="animate-spin" /> : <Send />}
                                    <span>送出並領取報告</span>
                                </button>
                            </div>
                        ) : (
                            <div className="text-center p-20 bg-white rounded-[50px] shadow-xl fade-in">
                                <CheckCircle className="w-20 h-20 text-green-600 mx-auto mb-6" />
                                <h2 className="text-3xl font-bold mb-4">預約成功</h2>
                                <p className="text-gray-400 mb-8">顧問將於 24 小時內與您聯繫</p>
                                <button onClick={() => location.reload()} className="text-[#C5A059] font-bold border-b-2 border-[#C5A059]">重新開始旅程</button>
                            </div>
                        )}
                    </div>
                );
            }

            const current = scenarioData[step];
            return (
                <div className="min-h-screen flex flex-col md:flex-row overflow-hidden">
                    <div className="w-full h-[40vh] md:h-screen md:w-1/2 bg-white flex items-center justify-center relative shadow-inner">
                        {imgLoading && !imgCache[step] && <div className="animate-pulse text-[#C5A059] font-bold text-xs tracking-widest uppercase">繪製中...</div>}
                        {imgCache[step] ? <img src={imgCache[step]} className="w-full h-full object-cover image-sketch fade-in" /> : <div className="text-gray-200"><ImageIcon size={48} /></div>}
                        <div className="absolute inset-0 bg-gradient-to-r from-transparent to-[#FDFBF7] hidden md:block" />
                    </div>
                    <div className="w-full h-[60vh] md:h-screen md:w-1/2 flex flex-col justify-center px-8 md:px-24 bg-[#FDFBF7] paper-texture">
                        <div className="max-w-xl mx-auto w-full">
                            <span className="text-[#C5A059] text-[10px] font-black tracking-widest uppercase block mb-12">Scene {step+1}</span>
                            <div key={step} className="fade-in">
                                <p className="text-4xl md:text-5xl font-story font-bold mb-12 leading-tight italic text-[#2D3436]">「{current.scenario}」</p>
                                <h2 className="text-gray-400 text-lg md:text-xl font-medium mb-12 border-l-4 pl-8 border-[#C5A059]/20">{current.query}</h2>
                                <div className="space-y-4">
                                    {current.options.map((opt, i) => (
                                        <button key={i} onClick={() => handleSelect(i)} className="w-full text-left p-6 rounded-2xl border hover:border-[#C5A059] hover:bg-white transition-all btn-active group flex items-center justify-between bg-white/50">
                                            <span className="text-lg font-medium text-gray-700 group-hover:text-[#C5A059]">{opt}</span>
                                            <ChevronRight className="text-gray-200 group-hover:text-[#C5A059]" />
                                        </button>
                                    ))}
                                </div>
                            </div>
                            <footer className="mt-20 flex items-center gap-10">
                                <button className={`p-3 rounded-full border text-gray-300 ${step === 0 ? 'opacity-0 pointer-events-none' : 'hover:border-[#C5A059] hover:text-[#C5A059]'}`} onClick={() => setStep(step - 1)}>
                                    <ArrowLeft size={24} />
                                </button>
                                <div className="flex-1 bg-gray-100 h-0.5 rounded-full overflow-hidden">
                                    <div className="bg-[#C5A059] h-full transition-all duration-1000" style={{ width: `${((step + 1) / 10) * 100}%` }} />
                                </div>
                            </footer>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
